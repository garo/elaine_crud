<%# Export button with dropdown menu for CSV/Excel/JSON formats %>
<div class="relative inline-block text-left" id="export-dropdown">
  <button type="button"
          onclick="toggleExportDropdown(event)"
          class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded shadow-sm transition-colors duration-200">
    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
    </svg>
    Export
    <svg class="ml-2 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
    </svg>
  </button>

  <div id="export-menu"
       class="hidden absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50">
    <div class="py-1" role="menu" style="max-height: 300px; overflow-y: auto;">
      <%= link_to({action: :export, format: :csv, search: params[:search], sort: params[:sort], direction: params[:direction], filter: params[:filter]},
                  {class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-150 no-underline",
                   role: "menuitem",
                   style: "display: flex; text-decoration: none;"}) do %>
        <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <span>CSV Format</span>
      <% end %>

      <%= link_to({action: :export, format: :xlsx, search: params[:search], sort: params[:sort], direction: params[:direction], filter: params[:filter]},
                  {class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-150 no-underline",
                   role: "menuitem",
                   style: "display: flex; text-decoration: none;"}) do %>
        <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
        </svg>
        <span>Excel (XLSX)</span>
      <% end %>

      <%= link_to({action: :export, format: :json, search: params[:search], sort: params[:sort], direction: params[:direction], filter: params[:filter]},
                  {class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-150 no-underline",
                   role: "menuitem",
                   style: "display: flex; text-decoration: none;"}) do %>
        <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
        </svg>
        <span>JSON Format</span>
      <% end %>
    </div>
  </div>
</div>

<script>
  function toggleExportDropdown(event) {
    event.stopPropagation();
    const menu = document.getElementById('export-menu');
    menu.classList.toggle('hidden');
  }

  // Close dropdown when clicking outside
  document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('export-dropdown');
    const menu = document.getElementById('export-menu');
    if (dropdown && menu && !dropdown.contains(event.target)) {
      menu.classList.add('hidden');
    }
  });
</script>

<%# Reusable table grid component for displaying records in a grid layout %>
<%# Required locals: records (collection), columns (array of symbols) %>
<%# Optional locals: show_actions (boolean, default: true) %>

<% show_actions = local_assigns.fetch(:show_actions, true) %>

<% if records.any? %>
  <%# Calculate layout header to determine grid structure %>
  <% header_layout = calculate_layout_header(columns.map(&:to_sym)) %>

  <%# Remove ROW-ACTIONS column if show_actions is false %>
  <% unless show_actions %>
    <% header_layout = header_layout.reject { |config| config[:field_name].to_s == 'ROW-ACTIONS' } %>
  <% end %>

  <% grid_template = header_layout.map { |config| config[:width] }.join(' ') %>

  <div class="overflow-x-auto">
    <%# Main grid container - grid template defined once here for entire table %>
    <div class="bg-white shadow-md border border-gray-300 inline-block min-w-full" style="display: grid; grid-template-columns: <%= grid_template %>;">
      <%# Header row - render all headers from layout %>
      <% header_layout.each do |header_config| %>
        <% if header_config[:field_name].to_s == 'ROW-ACTIONS' %>
          <%# Actions column header %>
          <div class="px-3 py-3 text-xs font-medium text-gray-700 uppercase tracking-wider border-b-2 border-gray-200 bg-gray-100">
            Actions
          </div>
        <% else %>
          <%# Regular column header %>
          <div class="px-3 py-3 text-xs font-medium text-gray-700 uppercase tracking-wider border-r border-b-2 border-gray-200 bg-gray-100">
            <% if header_column_sortable?(header_config) %>
              <%= link_to sort_url_for(header_config[:field_name]), class: "flex items-center hover:text-blue-600 transition-colors duration-200" do %>
                <span><%= header_column_title(header_config) %></span>
                <%= sort_indicator(header_config[:field_name]).html_safe %>
              <% end %>
            <% else %>
              <span><%= header_column_title(header_config) %></span>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <%# Records - each cell is a direct grid child %>
      <% records.each_with_index do |record, index| %>
        <% record_id = "record_#{record.id}" %>
        <% row_bg_class = index.even? ? "bg-white" : "bg-gray-50" %>
        <% is_last_record = index == records.length - 1 %>
        <%# Render normal view row %>
        <%= render 'elaine_crud/base/view_row', record: record, columns: columns, row_bg_class: row_bg_class, record_id: record_id, is_last_record: is_last_record, show_actions: show_actions %>
      <% end %>
    </div>
  </div>
<% else %>
  <div class="bg-gray-50 border border-gray-200 rounded-lg p-8 text-center">
    <h3 class="text-lg font-medium text-gray-900 mb-2">No records found</h3>
    <p class="text-gray-600">No data to display.</p>
  </div>
<% end %>

<%# Custom Library Show View - demonstrates extending ElaineCrud with computed stats and sub-tables %>

<div class="container mx-auto px-4 py-8">
  <%# Header with navigation buttons %>
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-900"><%= @record.name %></h1>
    <div class="space-x-2">
      <%= link_to "Edit",
          url_for(action: :edit, id: @record.id),
          class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
      <%= link_to "Back to Libraries",
          url_for(action: :index),
          class: "text-gray-600 hover:text-gray-900" %>
    </div>
  </div>

  <%# Custom instruction text with computed statistics %>
  <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
    <div class="flex">
      <div class="ml-3">
        <h2 class="text-lg font-semibold text-blue-900 mb-2">ðŸ“š Library Overview</h2>
        <p class="text-blue-800">
          <strong><%= @record.name %></strong> serves <%= @record.city %>, <%= @record.state %> with
          <strong><%= @total_book_copies %></strong> book <%= 'copy'.pluralize(@total_book_copies) %> from
          <strong><%= @unique_books %></strong> unique <%= 'title'.pluralize(@unique_books) %>.
          <% if @available_copies > 0 %>
            <strong><%= @available_copies %></strong> <%= 'copy'.pluralize(@available_copies) %> available for checkout.
          <% else %>
            <span class="text-orange-700">No copies currently available for checkout.</span>
          <% end %>
          Currently <strong><%= @active_members %></strong> active <%= 'member'.pluralize(@active_members) %> registered and
          <strong><%= @librarians.count %></strong> <%= 'librarian'.pluralize(@librarians.count) %> on staff.
        </p>
      </div>
    </div>
  </div>

  <%# Standard library details using ElaineCrud's reusable show_details partial %>
  <div class="mb-8">
    <%= render partial: 'elaine_crud/base/show_details',
               locals: { record: @record, columns: @columns, title: 'Library Details' } %>
  </div>

  <%# Librarians sub-table using ElaineCrud's reusable index_table partial %>
  <div class="mb-8">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold text-gray-900">Librarians at this Library</h2>
      <%= link_to "View All Librarians",
          url_for(controller: :librarians, action: :index, library_id: @record.id),
          class: "text-blue-600 hover:text-blue-800 underline text-sm" %>
    </div>

    <% if @librarians.any? %>
      <%# Reuse ElaineCrud's index_table partial - demonstrates component reusability %>
      <%= render partial: 'elaine_crud/base/index_table',
                 locals: {
                   records: @librarians,
                   columns: @librarian_columns,
                   show_actions: false
                 } %>
    <% else %>
      <div class="bg-gray-50 border border-gray-200 rounded-lg p-8 text-center">
        <h3 class="text-lg font-medium text-gray-900 mb-2">No librarians assigned</h3>
        <p class="text-gray-600 mb-4">This library doesn't have any librarians yet.</p>
        <%= link_to "Add Librarian",
            url_for(controller: :librarians, action: :new, library_id: @record.id),
            class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
      </div>
    <% end %>
  </div>

  <%# Action buttons %>
  <div class="flex justify-end space-x-3">
    <%= link_to "Edit Library",
        url_for(action: :edit, id: @record.id),
        class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
<%= button_to "Delete Library",
        url_for(action: :destroy, id: @record.id),
        method: :delete,
        form: {
          class: "inline",
          data: { turbo: false },
          onsubmit: "return confirm('Are you sure you want to delete this library and all its associated data?');"
        },
        class: "bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" %>
  </div>
</div>
